"""This file was auto-generated by sqlsynthgen but can be edited manually."""
from mimesis import Generic
from mimesis.locales import Locale
from sqlsynthgen.base import FileUploader, TableGenerator
from sqlsynthgen.unique_generator import UniqueGenerator

generic = Generic(locale=Locale.EN_GB)

{% for provider_import in provider_imports %}
from sqlsynthgen.providers import {{ provider_import }}
generic.add_provider({{ provider_import }})
{% endfor %}

import {{ tables_module.__name__ }}
{% if row_generator_module_name is not none %}
import {{ row_generator_module_name }}
{% endif %}
{% if story_generator_module_name is not none %}
import {{ story_generator_module_name }}
{% endif %}

{% if src_stats_filename %}
import yaml
with open("{{ src_stats_filename }}", "r", encoding="utf-8") as f:
    SRC_STATS = yaml.unsafe_load(f)
{% endif %}

{% for table_data in vocabulary_tables %}
{{ table_data.variable_name }} = FileUploader({{ tables_module.__name__ }}.{{ table_data.table_name }})
{% endfor %}

{% for table_data in tables %}
class {{ table_data.class_name }}(TableGenerator):
    num_rows_per_pass = {{ table_data.rows_per_pass }}

    def __init__(self):
        pass
        {% for constraint in table_data.unique_constraints %}
        self.unique_{{constraint.name}} = UniqueGenerator([
                {% for col in constraint.columns %}
                "{{col.name}}"{%- if not loop.last %}, {% endif %}
                {% endfor %}
            ],
            "{{table_data.table_name}}",
            {% if max_unique_constraint_tries is not none %}
            max_tries={{max_unique_constraint_tries}},
            {% endif %}
        )
        {% endfor %}

    def __call__(self, dst_db_conn):
        result = {}
        {% for row_gen in table_data.row_gens %}
        {% if not row_gen.primary_key %}
        {% for vn in row_gen.variable_names %}
        result["{{vn}}"]{%- if not loop.last %}, {% endif %}
        {% endfor %} = {{ row_gen.function_call.function_name }}({{ row_gen.function_call.argument_values| join(", ") }})
        {% endif %}
        {% endfor %}
        return result
{% endfor %}

table_generator_dict = {
{% for table_data in tables %}
    "{{ table_data.table_name }}": {{ table_data.class_name }}(),
{% endfor %}
}


vocab_dict = {
{% for table_data in vocabulary_tables %}
    "{{ table_data.dictionary_entry }}": {{ table_data.variable_name }},
{% endfor %}
}

{% for gen_data in story_generators %}
def {{ gen_data.wrapper_name }}(dst_db_conn):
    return {{ gen_data.function_call.function_name }}({{ gen_data.function_call.argument_values| join(", ") }})
{% endfor %}

story_generator_list = [
    {% for gen_data in story_generators %}
    {
        "function": {{ gen_data.wrapper_name }},
        "num_stories_per_pass": {{ gen_data.num_stories_per_pass }},
        "name": "{{ gen_data.function_call.function_name }}",
    },
    {% endfor %}
]
